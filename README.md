# Analyze-EntraCAPolicies.ps1

## Overview

This PowerShell script analyzes Entra ID Conditional Access (CA) policies against a defined set of common security best practices and recommendations from Microsoft. It takes policy data previously exported by `Get-EntraConditionalAccessPolicies.ps1` (in JSON format) as input.

The script performs specific checks, assigns severity levels to non-compliant findings, calculates a basic overall compliance score, and outputs a detailed assessment report in CSV format.

## Purpose

The primary goal of this script is to provide a quick, automated assessment of your Conditional Access policy configuration against foundational security recommendations. It helps identify potential gaps or areas for improvement in your CA policy posture based on common hardening guidelines.

**Note:** This script provides a basic assessment based on predefined checks. It is not a substitute for a thorough security review by a qualified professional or tools like Microsoft Secure Score, which have more sophisticated analysis capabilities.

## Features

* Reads CA policy data from a JSON file.
* Performs checks against predefined security best practices (e.g., Legacy Auth blocking, Admin MFA, High-Risk Sign-in/User handling).
* Assigns severity levels (High, Medium, Low) to non-compliant checks.
* Calculates a simple overall compliance score based on the implemented checks.
* Outputs detailed findings, recommendations, and severity for each check into a CSV file.
* Provides a summary of results to the console.

## Prerequisites

1.  **PowerShell:** PowerShell 5.1 or later (PowerShell 7+ recommended).
2.  **Input JSON File:** A valid JSON file containing Conditional Access policy data, generated by running `Get-EntraConditionalAccessPolicies.ps1` with the `-OutputFormat JSON` parameter.

## Parameters

* `-JsonInputPath <String>`
    * **Mandatory.** Specifies the full path to the input JSON file exported from `Get-EntraConditionalAccessPolicies.ps1`.
    * Example: `C:\Exports\CAPolicies.json`
* `-CsvOutputPath <String>`
    * **Mandatory.** Specifies the full path (including filename) where the CSV assessment report will be saved.
    * Example: `C:\Reports\CA_Assessment_Report.csv`

## How it Works

1.  **Loads Data:** Reads the policy objects from the specified JSON file.
2.  **Runs Checks:** Iterates through a predefined list of check functions (e.g., `Test-LegacyAuthBlocked`, `Test-AdminMfaRequired`).
3.  **Analyzes Policies:** Each check function analyzes the loaded policy data to determine if the configuration meets the specific best practice criteria.
4.  **Records Findings:** Each check returns a result object containing the check name, compliance status (`Compliant`, `Non-Compliant`, `Not Applicable`, `Error`), severity, a finding description, and a recommendation.
5.  **Calculates Score:** A simple percentage score is calculated based on the number of 'Compliant' checks relative to the total number of applicable checks performed without errors.
6.  **Exports Report:** The detailed results for all checks are compiled and exported to the specified CSV file.

## Usage Example

```powershell
# 1. First, generate the JSON export using the Get script:
# .\Get-EntraConditionalAccessPolicies.ps1 -OutputFile .\CAPolicies.json -OutputFormat JSON

# 2. Then, run the analysis script using the generated JSON file:
.\Analyze-EntraCAPolicies.ps1 -JsonInputPath .\CAPolicies.json -CsvOutputPath .\CA_Assessment_Report.csv

Output CSV ReportThe generated CSV file (-CsvOutputPath) will contain the following columns:CheckName: The name of the best practice check performed.Status: The result of the check (Compliant, Non-Compliant, Not Applicable, Error).Severity: The assigned severity level for non-compliant findings (High, Medium, Low, Informational, N/A).Finding: A description of what the script found related to this check.Recommendation: Actionable guidance or suggestions based on the finding.This CSV file can be easily opened in spreadsheet software like Microsoft Excel for filtering, sorting, creating visualizations, and tracking remediation efforts.Notes & LimitationsBest Practice Definitions: The checks are based on a specific interpretation of common Microsoft recommendations at the time the script was written. These recommendations evolve, and the script's logic may need updates.Scope: This script performs a predefined set of checks. It does not cover all possible Entra ID best practices or Conditional Access configurations.Policy Interactions: The analysis is primarily based on identifying policies with specific characteristics. It performs limited analysis of complex interactions or overlaps between multiple policies.Exclusions: While some checks might mention exclusions, the script does not deeply analyze the appropriateness or scope of exclusions within policies. This requires manual review.Context is Key: The assessment provides technical findings. Whether a "Non-Compliant
